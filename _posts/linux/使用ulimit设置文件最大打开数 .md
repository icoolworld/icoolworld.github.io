
使用ulimit设置文件最大打开数 


大家都知道Linux系统默认打开文件数是1024，而实际的生产环境中，这个值总是显得太小，而太小的后果就是你的系统会报：too many open files 等这样的错误导致你系统死掉，所以我们总是要修改这个值，虽然表面上看来，Linux提供了ulimit这样的命令让你修改这个文件打开数，但不幸的是，过程远远没有看到的那么简单，下面子猴就谈谈这方面的问题。

1、  首先我们通过ulimit Ca命令来查看系统的一些资源限制情况，如下：

红框中所示的是最大文件打开数，一般情况下是1024，但由于我系统已经改为了32768，所以现在看到的是32768。

我们也可以通过ulimit Cn命令来查看最大文件打开数，如下：

32768

2、  修改目标

我们的目标是：让每一个用户登录系统后系统打开的最大文件数都是我们设定好的。

但我这里不得不说的是：非常遗憾，网上很多这方面关于ulimit设置修改资源限制的文章，但没一篇文章管用。

把这个目标分解为两个目标：

2.1、设置对root用户登录系统生效

这个目标可以实现起来不难

2.2、设置对所有用户生效

这个就非常麻烦了，弄不好还会把你的系统给整坏，因为要重编译Linux的内核才行！

所以权衡之下，我只实现了第一个目标，因为第二个目标的风险太大，我想如果我之前知道这点，那么我在装系统的时候我会先做这个处理，但现在我觉得已经晚了。

3、  修改的地方

3.1、修改/etc/security/limits.conf

通过 vi /etc/security/limits.conf修改其内容，在文件最后加入（数值也可以自己定义）：

*                soft    nofile          65535
*                hard    nofile          65535

3.2、修改/etc/profile

通过vi /etc/profile修改，在最后加入以下内容

ulimit -n 32768

然后重新登录即可生效了。

说明：

其实只修改/etc/profile就可以生效了，但我还是建议把/etc/security/limits.conf也修改一下。

最后强调的是，你如果要使得修改对所有用户都生效，那么现在看来你只能重新编译Linux的内核才行。